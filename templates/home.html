<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NoBait - Email Phishing Detector</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    
    <style>
        /* --- General Aesthetics & Layout --- */
        body { background-color: #f8f9fa; }
        .card { 
            border: none; 
            border-radius: 12px; 
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05); /* Subtle shadow */
        }
        h1, h2, h3, h4 { color: #2c3e50; } /* Darker text for titles */
        
        /* --- Statistics Boxes --- */
        .stat-box {
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            transition: transform 0.2s;
            min-height: 150px;
        }
        .stat-box:hover {
            transform: translateY(-3px); /* Lift effect on hover */
        }
        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
            opacity: 0.8;
        }

        /* --- Analysis Table & Scroll --- */
        .scroll-box {
            max-height: 500px;
            overflow-y: auto;
        }
        .table thead th {
            position: sticky;
            top: 0;
            z-index: 10;
            background-color: #f8f9fa; /* Ensure header stands out when scrolling */
        }
        
        /* --- Risk Badges & Color Coding --- */
        .risk-badge {
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 0.85rem;
            display: inline-block;
        }
        /* Define the colors based on your thresholds (0-49=Safe, 50-64=Low, 65-80=Medium, >=81=High) */
        .risk-safe { background-color: #e6f7ea; color: #1e7e34; border: 1px solid #c3e6cb; } /* Light Green */
        .risk-low { background-color: #fff3cd; color: #856404; border: 1px solid #ffeeba; } /* Yellow/Warning */
        .risk-medium { background-color: #fce7e8; color: #842029; border: 1px solid #f5c6cb; } /* Light Red/Salmon */
        .risk-high { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; } /* Strong Red */

        /* --- Classification Thresholds --- */
        .classification-box {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }
        .score-value { font-weight: bold; font-size: 1.1rem; }

        /* Match threshold colors to risk badges */
        .safe-threshold { background-color: #e6f7ea; border-left: 5px solid #1e7e34; }
        .low-threshold { background-color: #fff3cd; border-left: 5px solid #856404; }
        .medium-threshold { background-color: #fce7e8; border-left: 5px solid #842029; }
        .high-threshold { background-color: #f8d7da; border-left: 5px solid #721c24; }
        
        /* --- Analyzer Form --- */
        .form-control[type="file"] { border: 1px solid #ced4da; }

    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-shield-alt me-2"></i>
                NoBait
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#"><i class="fas fa-home me-1"></i> Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#analyzer"><i class="fas fa-search me-1"></i> Analyze</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-5 pt-4">
        <h1 class="mb-4 pt-3">Welcome to NoBait</h1>
        <p class="mb-5 text-muted">
            NoBait is an intelligent email analysis engine that identifies phishing attempts by analyzing headers, subject lines, and content to calculate a dynamic threat score. üõ°Ô∏è
        </p>

        <div class="row mb-5">
            <div class="col-md-4 col-6 mb-3">
                <div class="card stat-box bg-primary text-white">
                    <i class="fas fa-envelope-open-text stat-icon"></i>
                    <h2 class="display-5">{{ total_scanned|default(0) }}</h2>
                    <p class="lead mb-0">Emails Scanned</p>
                </div>
            </div>
            <div class="col-md-4 col-6 mb-3">
                <div class="card stat-box bg-success text-white">
                    <i class="fas fa-check-circle stat-icon"></i>
                    <h2 class="display-5">{{ total_safe|default(0) }}</h2>
                    <p class="lead mb-0">Safe Emails (Score 0-49)</p>
                </div>
            </div>
            <div class="col-md-4 col-6 mb-3">
                <div class="card stat-box bg-danger text-white">
                    <i class="fas fa-exclamation-triangle stat-icon"></i>
                    <h2 class="display-5">{{ total_suspicious|default(0) }}</h2>
                    <p class="lead mb-0">Suspicious (Score >=50)</p>
                </div>
            </div>
        </div>
        
        <div class="row mb-5">
            
            <!--- Details of email results -->
            <div class="col-lg-8 mb-4">
                <div class="card">
                    <div class="card-header h4 bg-white border-bottom">
                        Recent Email Analysis
                    </div>
                    <div class="card-body p-0 scroll-box">
                        <div class="list-group list-group-flush">
                            {% for email in recent_analyses %}
                            <div class="list-group-item">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    
                                    <div>
                                        <h5 class="mb-1 text-truncate" style="font-weight: bold;">{{ email.title|default("No Subject Provided") }}</h5>
                                        <p class="text-muted small mb-2">{{ email.sender_email|default("unknown@example.com") }}</p>
                                        
                                        <p class="mb-1"><strong>Risk Score:</strong> <span class="badge bg-dark">{{ email.risk_score|default(0)|round(0) }}</span></p>
                                        
                                        <p class="small text-dark mb-0">
                                            <i class="fas fa-info-circle me-1"></i> 
                                            {{ email.reason|default("No suspicious elements detected.") }}
                                        </p>
                                    </div>
                                    
                                    <div class="text-end">
                                        <span class="risk-badge 
                                            {% if email.risk_score >= 81 %} risk-high 
                                            {% elif email.risk_score >= 65 %} risk-medium 
                                            {% elif email.risk_score >= 50 %} risk-low 
                                            {% else %} risk-safe {% endif %} mb-2">
                                            {{ email.conclusion|default("Safe") }}
                                        </span>
                                        
                                        <p class="text-muted small mb-0 mt-3">Scanned: {{ email.time_of_scan|default("Just now") }}</p>
                                    </div>
                                </div>
                            </div>
                            {% else %}
                            <div class="list-group-item text-center text-muted p-4">
                                No recent analysis data available.
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4 mb-4">
                <div class="card">
                    <div class="card-header h5 bg-white border-bottom">
                        Classification Thresholds
                    </div>
                    <div class="card-body">
                        <div class="classification-box safe-threshold">
                            <h5><i class="fas fa-check-circle me-1"></i> Safe Email</h5>
                            <p class="score-value mb-0">Score: <strong>0 - 49</strong></p>
                        </div>
                        
                        <h5 class="mt-3 mb-2 text-muted">Suspicious Email:</h5>
                        <div class="classification-box low-threshold">
                            <h6><i class="fas fa-exclamation-circle me-1"></i> Low Risk</h6>
                            <p class="score-value mb-0">Score: <strong>50 - 64</strong></p>
                        </div>
                        <div class="classification-box medium-threshold">
                            <h6><i class="fas fa-triangle-exclamation me-1"></i> Medium Risk</h6>
                            <p class="score-value mb-0">Score: <strong>65 - 80</strong></p>
                        </div>
                        <div class="classification-box high-threshold">
                            <h6><i class="fas fa-skull-crossbones me-1"></i> High Risk (Phishing)</h6>
                            <p class="score-value mb-0">Score: <strong>>= 81</strong></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mb-5">
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-header h5 bg-white border-bottom">
                        <i class="fas fa-file-upload me-2"></i>Bulk Email Analysis
                    </div>
                    <div class="card-body">
                        <form id="bulkAnalyzeForm" action="/analyze-bulk" method="post" enctype="multipart/form-data">
                            
                            <div class="mb-3">
                                <label for="bulkEmailFiles" class="form-label">Upload multiple `.eml` or `.txt` files:</label>
                                <input class="form-control" type="file" id="bulkEmailFiles" name="email_files" accept=".eml,.txt" multiple required>
                                <small class="text-muted">You can select multiple files at once. The analysis will begin upon submission.</small>
                            </div>
                            
                            <button type="submit" class="btn btn-primary w-100">
                                <i class="fas fa-layer-group me-1"></i> Run Bulk Analysis
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-5" id="analyzer">
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-header h5 bg-white border-bottom">
                        <i class="fas fa-search me-2"></i>Analyze Single Email
                    </div>
                    <div class="card-body">
                        <form id="analyzeForm" action="/analyze-single" method="post" enctype="multipart/form-data">
                            
                            <div class="mb-3">
                                <label for="emailFileInput" class="form-label">Upload single `.eml` or `.txt` file:</label>
                                <input class="form-control" type="file" id="emailFileInput" name="email_file" accept=".eml,.txt">
                            </div>
                            
                            <hr class="my-4">
                            <p class="text-center text-muted small">OR PASTE RAW CONTENT</p>
                            
                            <div class="mb-3">
                                <label for="emailContent" class="form-label">Paste raw email content:</label>
                                <textarea class="form-control" id="emailContent" name="email_content" rows="6" placeholder="From: sender@example.com&#10;To: recipient@example.com&#10;Subject: Your Subject Here..."></textarea>
                            </div>
                            
                            <button type="submit" class="btn btn-dark w-100" id="analyzeBtn">
                                <i class="fas fa-paper-plane me-1"></i> Run Single Analysis
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Form validation to ensure at least one field is used before submission
        document.getElementById('analyzeForm').addEventListener('submit', function(event) {
            const fileInput = document.getElementById('emailFileInput');
            const contentTextarea = document.getElementById('emailContent');
            
            // Prevent submission if both fields are empty
            if (!fileInput.files.length && !contentTextarea.value.trim()) {
                alert('Please upload an email file OR paste the raw email content before running analysis.');
                event.preventDefault();
            }
        });
    </script>
</body>
</html>